(function(k){var c=window.AmazonUIPageJS||window.P,n=c._namespace||c.attributeErrors,b=n?n("CheckoutCartPrefetchAsset",""):c;b.guardFatal?b.guardFatal(k)(b,window):b.execute(function(){k(b,window)})})(function(k,c,n){k.when("A","CartServerSetting","CartCheckoutPrefetch-DeviceAgnosticFunctions").register("CartCheckoutPrefetchDesktop",function(b,r,h){function l(){return"/gp/buy/prefetch/store-html.html"}function g(){if(h.isTangoPreinitiateEligible())p=!1,h.javaCheckoutPreinitiate();else{p=!0;var b=
(new Date).getTime(),g="/gp/cart/checkout-prefetch.html?cartInitiateId\x3d"+b,d=h.getBuyBoxParameters(n),c;for(c in d)d.hasOwnProperty(c)&&(g+="\x26"+c+"\x3d"+encodeURIComponent(d[c]));h.streamJSONPrefetchRequest(g,"PreInitiate:",h.executionIdSuccessHandler,b);h.insertValueInBuyBox("cartInitiateId",b)}}function d(b){p&&f(b)}function f(b){function d(){5>t&&(h.fireAndForgetPrefetchRequest(b,"StoreHtml:"),t++,q=setTimeout(d,6E4))}m(c).ready(function(){q=setTimeout(d,6E4)})}var m=b.$,n=["partialCheckoutCart"],
q,t=0,p=!0,v=r.features.disableCheckoutPrefetchCaching;k.when("total-purchase-cost-prefetch-listeners").register("setupCartCheckoutPrefetch",function(){var c=!1,f=!1;v&&h.clearJavaPreinitValuesInBuyBox();b.state.bind("checkout-url-migration-page-state",function(b,c){h.customerEligibilityChangeHandler(b,c,g)});b.on("sc:checkout-prefetch:start",function(){c=!0});b.on("sc:checkout-prefetch:complete",function(){c=!1;f&&m("#sc-buy-box form").submit()});b.on("tango:checkout:eligible:skipGurupaPrefetch",
function(){c=!1;f&&m("#sc-buy-box form").submit()});m(document).delegate("#sc-buy-box form","submit",function(b){return c?(f=!0,b.preventDefault(),!1):!0});g();d(l());b.on("sc:checkout-prefetch",function(){clearTimeout(q);g();d(l())});b.on("affordability:clipCoupon:success",function(){g()});b.on("shopwithpoints:preferenceUpdate:success",function(b){g();h.logUECounter(b+"::TriggerPrefetchOnSuccess::Success",1)})})});"use strict";k.when("A","CartServerSetting").register("CartCheckoutPrefetch-DeviceAgnosticFunctions",
function(b,k){function h(a,e){b.trigger("sc:checkout-prefetch:start",{prefetchPromise:a});e&&(y=e)}function l(a){b.trigger("sc:checkout-prefetch:complete",a)}function g(a,b){"undefined"!==typeof c.ue&&"undefined"!==typeof c.ue.count&&c.ue.count(a,b||1)}function d(){var a=document.getElementById("sc-buy-box");if(a&&(a=a.getElementsByTagName("form"),0!==a.length))return a[0]}function f(a,b){var c=d();if(c){m(c,a);var e=document.createElement("input");e.setAttribute("type","hidden");e.setAttribute("value",
b);e.setAttribute("name",a);c.appendChild(e)}}function m(a,b){if(a)for(var c=a.getElementsByTagName("input"),e=0;e<c.length;e++)c[e].name===b&&a.removeChild(c[e])}function r(){var a=d();a&&(m(a,"preInitiateExecutionId"),m(a,"preInitiatePurchaseId"),m(a,"isJavaPreinitiate"))}function q(a,b){b===y&&a&&a.executionHandle&&a.executionHandle.executionId&&(f("preInitiateExecutionId",a.executionHandle.executionId),a.executionHandle.purchaseId&&f("preInitiatePurchaseId",a.executionHandle.purchaseId),f("isJavaPreinitiate",
1))}function t(){p();z=setTimeout(r,3E5)}function p(){clearTimeout(z)}function v(a,b,d,g){if(c.fetch&&c.TextDecoderStream)return A(a,b,d,g);x(a,b,d,g)}function A(a,b,d,f){var e={"x-amzn-tiertwo":"yes"};"javaCheckoutPreInitiate:"===b&&(e["x-amz-checkout-transition"]="ajax");a=fetch(a,{headers:e,cache:"no-store"}).then(function(a){var c=a.body.pipeThrough(new TextDecoderStream).getReader(),e="";return c.read().then(function B(a){if(a.done){if(""===e.trim())return g(b+"prefetch_ajax_streaming_nodata",
1),null;throw Error("Could not read JSON data from prefetch endpoint");}e+=a.value;try{var h=JSON.parse(e)}catch(C){return c.read().then(B)}d&&d(h,f);g(b+"prefetch_ajax_streaming_success",1);return h})}).catch(function(a){var e={message:"streamJSONUsingFetch failed"};c.ueLogError&&(e=e||{},e.logLevel=e.logLevel||"ERROR",e.attribution=e.attribution||"CheckoutCartPrefetchAsset: Website \x3e Amazon Checkout Pipeline \x3e Others",e.message=e.message||"",c.ueLogError(a,e));g(b+"prefetch_ajax_streaming_error",
1);return null}).then(function(a){l(a);return a});h(a,f);return a}function x(a,e,c,d){var f={"x-amzn-tiertwo":"yes"};"javaCheckoutPreInitiate:"===e&&(f["x-amz-checkout-transition"]="ajax");a=b.$.ajax(a.toString(),{cache:!1,headers:f,success:function(a,b,f){c&&c(a,d);g(e+"prefetch_ajax_jquery_success",1);l(a);return a},error:function(){g(e+"prefetch_ajax_jquery_error",1);l();return null}});h(a,d)}var u=!1,y,z,w=!1;return{streamJSONPrefetchRequest:v,fireAndForgetPrefetchRequest:function(a,b){x(a,b,
n,n)},getJavaCheckoutPreinitiateIdentifier:function(){return"javaCheckoutPreInitiate:"},executionIdSuccessHandler:function(a,b){a&&a.executionHandle&&a.executionHandle.executionId&&f("preInitiateExecutionId",a.executionHandle.executionId)},javaCheckoutPreintiateSuccessHandler:q,javaCheckoutPreinitiate:function(){var a=(new Date).getTime();t();var b="/checkout/entry/cart?isPreinit\x3d1\x26partialCheckoutCart\x3d1\x26pipelineType\x3dChewbacca\x26referrer\x3dcart";k.features.isEligibilityLogicDisabled&&
(b+="\x26isEligibilityLogicDisabled\x3d1");v(b,"javaCheckoutPreInitiate:",q,a)},isTangoPreinitiateEligible:function(){var a=document.getElementById("checkout-url-server-migration-status");return(w=a&&"true"===a.value)&&!u},customerEligibilityChangeHandler:function(a,b,c){b.checkoutUrl&&w&&(u=!a.checkoutUrl)&&(r(),c())},clearInvalidationTimer:p,setInvalidationTimeout:t,isAjaxCallBlocking:function(){return u},isJavaCheckoutServerStateEnabled:function(){return w},setAjaxBlockingFlag:function(a){u=a},
getBuyBoxForm:d,clearValueInBuyBox:m,clearJavaPreinitValuesInBuyBox:r,insertValueInBuyBox:f,getBuyBoxParameters:function(a){if(!d())return[];for(var c=b.$("#sc-buy-box input").serializeArray(),f={},g=0;g<c.length;g++)-1!==a.indexOf(c[g].name)&&(f[c[g].name]=c[g].value);return f},logUECounter:g}});"use strict";k.when("A","BYGServerSetting").register("BeforeYouCheckoutPagePrefetch",function(b,k){function h(g){l("byc_prefetch_ajax_call_initiate",1);b.$.ajax(g,{success:function(){l("prefetch_byc_ajax_jquery_success",
1)},error:function(b){l("prefetch_byc_ajax_jquery_error",1);c.ueLogError&&c.ueLogError(b,{logLevel:"ERROR",attribution:"CheckoutCartPrefetchAsset: Website \x3e Amazon Checkout Pipeline \x3e Others",message:"byc_firePrefetchRequest failed"})}})}function l(b,d){"undefined"!==typeof c.ue&&"undefined"!==typeof c.ue.count&&c.ue.count(b,d||1)}b.on("sc:byg:recs:added",function(g){l("byg_prefetch_converged_js_invoked",1);var d=b.$("a[name\x3dsc-byc-ptc-button]"),f=b.state("bygPageState").tangoUrl;d.attr("href")===
f&&g.isTurbo||!k.features||!k.features.enableBYGPrefetch||(g=(new Date).getTime(),d=new URL("/gp/cart/checkout-prefetch.html",c.location.origin),d.searchParams.set("checkAuthentication","1"),d.searchParams.set("checkDefaults","1"),d.searchParams.set("cartInitiateId",g),(f=(new URL(b.$("a[name\x3dsc-byc-ptc-button]").attr("href"),c.location.origin)).searchParams.get("partialCheckoutCart"))&&d.searchParams.set("partialCheckoutCart",f),h(d.href),d=b.$("a[name\x3dsc-byc-ptc-button]"),f=b.state("bygPageState").ingressUrl,
f=new URL(f,c.location.origin),f.searchParams.has("cartInitiateId")&&(f.searchParams.set("cartInitiateId",g),d.attr("href",f.pathname+f.search)))})})});