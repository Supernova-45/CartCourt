const e=()=>{window.dcmads=window.dcmads||{},window.dcmads.eids="4|40004007"},t="sfImpression",i="LightAdImpression",a="viewablelatency",n=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i});n("bodyBegin","bb"),n("bodyBegin","bb",t),n("bodyBegin","bb",i);const r=n("bodyEnd","be");n("clickToATF","af");const s=n("criticalFeature","cf");n("criticalFeature","cf",t),n("criticalFeature","cf",i);const o=n("loaded","ld"),l=n("loaded","ld",t);n("loaded","ld",i),n("viewablelatency:bodyBegin","bb",a),n("viewablelatency:loaded","ld",a);const d=()=>{Object.defineProperty(Document.prototype,"cookie",{get:()=>"",set:()=>{}})},c=()=>{var e,t;(null==(t=window)||null==(e=t.navigator)?void 0:e.geolocation)&&(window.navigator.geolocation.watchPosition=(e,t,i)=>0,window.navigator.geolocation.getCurrentPosition=(e,t,i)=>{})},m=(e,t)=>{console.error(e,t)},h=e=>{e.sendLatencyMetric(o),e.sendLatencyMetric(s)},u="sf iframe ready";var v,w,g=function(e){console.debug(e)},p=function(e,t){console.error(e,JSON.stringify(t)),f("ERROR",e,b(e,t))},y=function(e,t){console.error(e,JSON.stringify(t)),f("FATAL",e,b(e,t))},f=function(e,t,i){var a;null==(a=window.ueLogError)||a.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},b=function(e,t){return t instanceof Error?t:t?Error(t):Error(e)};const C=["amazon.com","amazon.in","amazon.de","amazon.co.jp","amazon.co.uk","amazon.ca","amazon.com.au","amazon.com.be","amazon.com.br","amazon.com.mx","amazon.com.tr","amazon.eg","amazon.es","amazon.fr","amazon.it","amazon.nl","amazon.pl","amazon.sa","amazon.se","amazon.sg","amazon.ae","amazon.co.za","amazon.cn","amazon.dev","boxofficemojo.com","a2z.com","console.harmony.a2z.com","depot.advertising.amazon.dev","harmony.a2z.com","d116tmsy8qpy37.cloudfront.net","d1u3onhraow3iz.cloudfront.net","d1ubtmbgqm1jlf.cloudfront.net","d2dk40qqpfbxei.cloudfront.net","d2jbcalcdp0p85.cloudfront.net","d2y0vsnh7zmbrq.cloudfront.net","d345aeerog89iv.cloudfront.net","imdb.com"],E=(e,t)=>t.some(t=>e.endsWith(t)),I=()=>{let e=document.referrer;if(!e)return!1;try{let t=new URL(e);return E(t.hostname,C)}catch(t){return p("Invalid referrer URL:",e),!1}};let M=null,T=null,P=null;const S=new class{viewabilityStandards(){return T=T||[]}payload(){return M=M||{}}},x={playingTime:()=>P=P||0},N=()=>S,_=()=>x,A=e=>{null===(M=(null==e?void 0:e.payload)!==void 0?null==e?void 0:e.payload:null)&&delete S.payload,null===(T=(null==e?void 0:e.viewabilityStandards)!==void 0?null==e?void 0:e.viewabilityStandards:null)&&delete S.viewabilityStandards},L=e=>{null===(P=e)&&delete x.playingTime},D="viewability",R="unservedviewability",z="adload:viewability",F="adload:unservedviewability";class k{constructor(e,t){this.weblabsWindow=e,this.prefix=t,this.isT1=()=>"t1"===this.weblabTreatment(),this.isT2=()=>"t2"===this.weblabTreatment(),this.isT3=()=>"t3"===this.weblabTreatment(),this.isT4=()=>"t4"===this.weblabTreatment(),this.isT5=()=>"t5"===this.weblabTreatment(),this.weblabTreatment=()=>{var e,t,i;return null==(i=this.weblabsWindow)||null==(t=i.renderingWeblabs)||null==(e=t[this.prefix])?void 0:e.toLowerCase()}}}const $=()=>new k(window,"ADPT_SF_HIGH_RATE_METRIC_LOGGING_1256364"),W=()=>new k(window,"ADPT_SF_PIXEL_FIRING_1151992"),O=()=>new k(window,"APM_STORES_JPS_JRS_SAFEFRAME_CLICK_TRACKING_PAINTER_TEST_1259727"),V=()=>new k(window,"APM_STORES_JPS_JRS_SAFEFRAME_DEDUPE_SF_VIDEO_PIXELS_1279569"),U="btr_client",B="cod_client",J=e=>"V"===e,q=e=>K(e),G=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,j=e=>G.test(e),H=e=>j(e)?q(e):e,K=e=>decodeURIComponent(escape(atob(e))),Z=e=>e&&0===Object.keys(e).length&&e.constructor===Object,X=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Q=(e,t,i)=>{if(""===t)throw Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));let a=new URL(e),n=Object.assign(JSON.parse(a.searchParams.get(t)||"{}"),i);return a.searchParams.set(t,JSON.stringify(n)),a.toString()},Y=(e,t)=>{let i=document.createElement("img");return i.id=e,i.style.display="none",i.setAttribute("pixel-url",t),i},ee=(e,t,i)=>{let a=e+t;return i&&(a+="_"+i),a},et=e=>!!document.getElementById(e),ei=async(e,{pixelUrl:t,id:i,baseCounterName:a,baseMetricName:n,counterExtension:r,logId:s,aaxProgramId:o})=>{try{if(et(i))return!1;return e.logCsaEvent(ee(n,"fired",r)),e.countMetric(ee(a,"fired",r),1),await fetch(t,{keepalive:!0,mode:"no-cors",priority:"low"}),document.getElementsByTagName("body")[0].appendChild(Y(i,t)),e.countMetric(ee(a,"loaded",r),1),e.logCsaEvent(ee(n,"loaded",r)),e.countMetric(`pixel:${s}`,1,!0),o&&e.countMetric(`pixel:${s}:${o}`,1,!0),!0}catch(i){throw e.countMetric(ee(a,"error",r),1),e.logCsaEvent(ee(n,"error",r)),e.logError(`Error firing pixels: ${t}`,i),i}},ea=(e,t,i)=>e+t+JSON.stringify(i),en="impressionFired",er="not_viewable";class es{constructor(){this._viewableStartTimeInMilliseconds=void 0,this._currentState=er,this._isCurrentlyInNotViewableState=()=>this._currentState===er,this.transitionToViewableState=e=>{this._isCurrentlyInNotViewableState()&&(this._viewableStartTimeInMilliseconds=e),this._currentState="viewable"},this.transitionToNotViewableState=()=>{this._currentState=er},this.getViewableTimeInSeconds=e=>this._isCurrentlyInNotViewableState()||void 0===this._viewableStartTimeInMilliseconds?0:(e-this._viewableStartTimeInMilliseconds)/1e3}}class eo{emitImpressionPixelMetrics(e){let t=this.o.adCreativeMetaData.adProgramId?this.o.adCreativeMetaData.adProgramId:"unknown",i=X(this.o);this.c.countMetric(en,1,!0),this.c.countMetric(en+":program:"+t,1,!0),this.c.countMetric(en+":template:"+i,1,!0);let a=e?"btr:impression":"cod:impression";this.c.countMetric(a,1,!1),this.c.countMetric(a,1,!0),this.c.countMetric(a+":program:"+t,1,!0),this.c.countMetric(a+":template:"+i,1,!0)}constructor(e,t){this.c=e,this.o=t,this.viewedPixels={},this.viewableTimeCalculators={},this.fireCodImpressionPixel=async()=>{let e=!1;await ei(this.c,{id:"ape_impression",pixelUrl:ed(this.o.aaxImpPixelUrl,"pj",B),baseCounterName:"adload:impression",baseMetricName:"impression",logId:"imp:cod",aaxProgramId:this.o.adCreativeMetaData.adProgramId})&&this.emitImpressionPixelMetrics(!1)},this.fireViewablePixelsForVideo=(e,t,i,a,n)=>{if(Z(this.o)||Z(this.c)||!this.o.aaxInstrPixelUrl||!i)return;let r=(e,t,i)=>{let a=e>=i.t,n=t&&t>=i.t;return a&&n},s=e=>{let i;t.v=e;let n=window.aPageStart,r=window.adStartTime;t.ptv=n?(Date.now()-n)/1e3:0,t.ttv=r?(Date.now()-r)/1e3:0,a&&(t.niv=!0),a?(i=ea(this.o.aaxInstrPixelUrl,"niv/",t),ei(this.c,{id:"ape_ni_viewability_"+e.def,pixelUrl:i,baseCounterName:F,baseMetricName:R,counterExtension:e.def,logId:"view:niv",aaxProgramId:this.o.adCreativeMetaData.adProgramId})):(i=ea(this.o.aaxInstrPixelUrl,"v/",t),ei(this.c,{id:"ape_viewability_"+e.def,pixelUrl:i,baseCounterName:z,baseMetricName:D,counterExtension:e.def,logId:`view:${e.def}`,aaxProgramId:this.o.adCreativeMetaData.adProgramId}))},o=(e,t)=>{let i=e.def;t&&el(t,e.p)?this.viewableTimeCalculators[i].transitionToViewableState(Date.now()):this.viewableTimeCalculators[i].transitionToNotViewableState();let a=this.viewableTimeCalculators[i].getViewableTimeInSeconds(Date.now());!this.viewedPixels[i].viewed&&r(a,n,e)&&(this.viewedPixels[i].viewed=!0,s(e))};for(let e=0;e<i.length;e++){let t=i[e].def;t&&(this.viewedPixels[t]=this.viewedPixels[t]||{},this.viewedPixels[t].viewed=void 0!==this.viewedPixels[t].viewed&&this.viewedPixels[t].viewed,void 0===this.viewableTimeCalculators[t]&&(this.viewableTimeCalculators[t]=new es))}for(let t=0;t<i.length;t++)o(i[t],e)},this.fireViewablePixels=(e,t,i,a)=>{let n=e=>{let i;t.v=e;let n=window.aPageStart,r=window.adStartTime;t.ptv=n?(Date.now()-n)/1e3:0,t.ttv=r?(Date.now()-r)/1e3:0,a&&(t.niv=!0),a?(i=ea(this.o.aaxInstrPixelUrl,"niv/",t),ei(this.c,{id:"ape_ni_viewability_"+e.def,pixelUrl:i,baseCounterName:F,baseMetricName:R,counterExtension:e.def,logId:"view:niv",aaxProgramId:this.o.adCreativeMetaData.adProgramId})):(i=ea(this.o.aaxInstrPixelUrl,"v/",t),ei(this.c,{id:"ape_viewability_"+e.def,pixelUrl:i,baseCounterName:z,baseMetricName:D,counterExtension:e.def,logId:`view:${e.def}`,aaxProgramId:this.o.adCreativeMetaData.adProgramId}))},r=t=>{let i=t.p,a=t.t,r=t.def;!this.viewedPixels[r].viewed&&e&&el(e,i)?this.viewedPixels[r].timeout||(this.viewedPixels[r].timeout=setTimeout(()=>{this.viewedPixels[r].viewed=!0,n(t)},1e3*a)):this.viewedPixels[r].timeout&&(clearTimeout(this.viewedPixels[r].timeout),this.viewedPixels[r].timeout=null)};for(let e of i){var s;let t=e.def;(null==(s=this.viewedPixels)?void 0:s[t])||(this.viewedPixels[t]={viewed:!1,timeout:null}),r(e)}}}}const el=(e,t)=>100*e>=t&&0!==t||100*e>t&&0===t,ed=(e,t,i)=>Q(e,t,{measurementMethod:i}),ec=async(e=document.body)=>{let t=0;return new Promise(i=>{let a=setInterval(()=>{var n;t+=5,(0===(n=Array.from(e.querySelectorAll("img")).filter(function(e){return"none"!==getComputedStyle(e).display})).length?{success:!1,code:"NO_CREATIVE"}:n.some(function(e){return e.complete&&e.naturalWidth>0&&e.naturalHeight>0})?{success:!0,code:"BEGIN_TO_RENDER"}:{success:!1,code:"ERROR"}).success?(clearInterval(a),i(U)):t>=75&&(clearInterval(a),i(B))},5)})},em=e=>{let t=`ProgramId: ${e.adCreativeMetaData.adProgramId}, CreativeId: ${e.adCreativeMetaData.adCreativeId}, AdId: ${e.adCreativeMetaData.adId}, Template: ${e.adCreativeMetaData.adCreativeTemplateName}`,i=eh(e.htmlContentEncodedLength);return`${t} (html size: ${i})`},eh=e=>void 0===e?"N/A":0===e?"0":e<=5e3?"0<x<=5k":e<=1e5?"5k<x<=100k":">100k",eu=e=>{var t;return null==(t=document.getElementById(eM))?void 0:t.setAttribute(e,"true")},ev=e=>new Promise((t,i)=>{let a=document.getElementById(eM);(null==a?void 0:a.getAttribute(eI))==="true"?t():(document.addEventListener(eT,()=>{eu(eI),t()},{once:!0}),setTimeout(()=>{(null==a?void 0:a.getAttribute(eI))!=="true"&&i(Error(`Creative script replay not detected within 5000 timeout. ${em(e)}`))},5e3))}),ew=(e,t)=>{let i=setInterval(async()=>{var a,n;if("function"==typeof(null==(n=window)||null==(a=n.crv)?void 0:a.detectAndReportBlankAd)){clearInterval(i);try{await window.crv.detectAndReportBlankAd(document.body)?(t.countMetric("blankadvalidation:failure",1,!0),t.logError(`Blank ad detected. ${em(e)}`)):t.countMetric("blankadvalidation:success",1,!0)}catch(e){t.countMetric("blankadvalidation:error",1,!0)}}},1e3)},eg=e=>e/window.innerWidth>=.95,ep=()=>{var e;return(null!=(e=document.documentElement.innerText)?e:"").replace(/\s/g,"").length>75},ey=e=>e.some(e=>e.classList.contains("ad-background-image")),ef=e=>{for(let t of e)if(eg(t.getBoundingClientRect().width))return!0;return!1},eb=()=>{let e=Array.from(document.querySelectorAll("img"));return!!e.length&&(!!ey(e)||!(!ef(e)||ep()))},eC=e=>{eb()&&e.sendMessage("resizeForImageOnlyTemplate")},eE=async(e,t,i,a)=>{i.countMetric("adload:renderstart",1),i.logCsaEvent("adload_renderstart");let n=ev(a);if(null!==document.currentScript){let t=document.currentScript;for(t.insertAdjacentHTML("afterend",e),t=t.nextElementSibling;null!==t;)"SCRIPT"===t.tagName?ex(t):e_(t),t=t.nextElementSibling}else eN(e),eS(),e_(document.documentElement);t.ensureGlobals(),await n,await eR(),t.renderCompleteTime=new Date,i.countMetric("adload:renderend",1),i.logCsaEvent("adload_renderend")},eI="iscomplete",eM="creativeReplayStatus",eT="creativeReplayComplete",eP=`document.dispatchEvent(new CustomEvent("${eT}"));`,eS=()=>{document.body.innerHTML+=`<script id="${eM}">${eP}</script>`},ex=e=>{var t,i;let a=document.createRange();a.selectNode(e);let n=a.createContextualFragment(e.outerHTML).firstElementChild;if(n.getAttribute("src"))n.async=!1;else{let t=e.innerHTML;n.async=!1,n.setAttribute("src",`data:text/javascript;charset=UTF-8,${encodeURIComponent(t)}`)}null==(t=e.parentNode)||t.insertBefore(n,e.nextSibling),null==(i=e.parentNode)||i.removeChild(e)},eN=e=>{if(void 0==document.documentElement){let e=document.createElement("html");document.appendChild(e)}document.documentElement.innerHTML=e},e_=e=>{for(let t of e.querySelectorAll("script"))ex(t)},eA=e=>e.naturalWidth>0||e.naturalHeight>0,eL=e=>0===e.height||0===e.width,eD=e=>{!e.complete||eA(e)||eL(e)};async function eR(){let e=Array.from(document.querySelectorAll("img")).filter(eD).map(e=>new Promise(t=>{e.addEventListener("load",()=>{t()},{once:!0})}));await Promise.all(e)}const ez=(e,t,i,a,n)=>{a.onPreCreativeWrite(i),W().isT1()?e.sendMessage("sendEventAddedCreative"):n.hasFiredCODPixel||(i.firePixelsAfter?e.sendMessage("fireImpressionWithDelay"):t.fireCodImpressionPixel(),n.hasFiredCODPixel=!0)},eF=async(e,t,i,a,n)=>{e$(),ek(),document.getElementsByTagName("iframe").length>0&&a.countMetric("nestedIframes",1);let r=e.btrPixelUrl?await ec():B;n.onCreativeBeginToRender(e);let s=r===U;s&&t.sendMessage("sendEventCreativeBeginToRender"),t.sendMessage("sendEventCreativeLoaded",{isBtr:s}),a.countMetric("adload:creativewritten",1),a.logCsaEvent("adload_creativewritten"),eO(),ew(e,a),eW(e)&&eC(t)},ek=()=>{eu("creativeLoad"),ti()},e$=()=>{eu("creativedomcontentloaded"),document.dispatchEvent(new Event("DOMContentLoaded"))},eW=e=>{var t;return["mweb","mshop"].includes(null==(t=e.deviceType)?void 0:t.toLowerCase())},eO=()=>{document.addEventListener("touchstart",{handleEvent:()=>{}},!1)},eV=new RegExp(/((&#\d{2,4};)|(&[a-z]{2};)|(&[a-z]{3,7};)|(%[a-fA-F0-9]{2})|(\W))pd_rd_plhdr(=|%3D)t((&#\d{2,4};)|(&[a-z]{2,7};)|(%[a-fA-F0-9]{2})|(\W))/),eU=(e,t)=>{let i=t,a=e;if("&pd_rd_plhdr=t"===e||""===e.trim())return i;(a=a.replace(/&amp;/g,"&")).startsWith("&")&&(a=a.replace(/^&+/,"")),a.endsWith("&")&&(a=a.replace(/&+$/,""));try{let e,t=0;do{if(t++,!(e=i.match(eV)))break;let n=e[1],r=e[8],s=e[7],o=n.startsWith("&")&&n.endsWith(";")||r.startsWith("&")&&r.endsWith(";"),l=n.startsWith("%")&&r.startsWith("%")&&"%3D"===s;i=o?i.replace(eV,"$1"+a.replace(/&/g,"&amp;")+"$8"):l?i.replace(eV,"$1"+encodeURIComponent(a)+"$8"):i.replace(eV,"$1"+a+"$8")}while(e&&t<10)}catch(e){return t}return i},eB=500,eJ=async(e,t=eB)=>new Promise(i=>{let a=-1,n=e=>{let t=e.data,n="percolateClickTracking";if(t.command!==n)throw Error(`Unexpected command ${t}, Expected ${n}`);window.clearTimeout(a),i(t.data)};a=window.setTimeout(()=>{e.removeEventListener("message",n),i(""),g(`Did not receive percolateClickTracking within ${t}ms`)},t),e.addEventListener("message",n,{once:!0}),e.start()});class eq extends Error{}const eG=(e,t)=>{let{onReport:i=()=>{}}=t;if(void 0!==window.ReportingObserver){let t=(t=[])=>{let a=ej(e);t.forEach(e=>{"intervention"===e.type&&i(new eq(JSON.stringify({adDetails:a,report:e.toJSON()})))})},a=new ReportingObserver(t,{buffered:!0});a.observe(),document.addEventListener("pagehide",()=>{t(a.takeRecords())})}},ej=e=>{let{adCreativeMetaData:t,creative:i,slotName:a,placementId:n,placementName:r,pageType:s}=e;return{adCreativeMetaData:t,creative:i,slotName:a,placementId:n,placementName:r,pageType:s}},eH="APE_CW_METRICS";let eK=!1;const eZ=e=>{eK||(window.addEventListener("beforeunload",()=>e0()),eK=!0);let t=eX();t.push(e),t.length>=10?eQ(t):eY(t)},eX=()=>{let e=localStorage.getItem(eH);if(!e)return[];try{return JSON.parse(e)}catch(e){return[]}},eQ=e=>{navigator.sendBeacon("https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",JSON.stringify(e)),localStorage.removeItem(eH)},eY=e=>{localStorage.setItem(eH,JSON.stringify(e))},e0=()=>{let e=eX();e.length>0&&eQ(e)},e1=({metricName:e,adDetails:t,count:i=1,additionalDimensions:a={}})=>{$().isT1()&&eZ(e3(e,i,e2(t,a)))},e3=(e,t,i)=>({metricName:e,timestamp:new Date().getTime(),count:t,dimensions:i,xApiKey:"aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ"}),e2=(e,t)=>{var i,a;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:null==(i=e.adCreativeMetaData)?void 0:i.adProgramId,creativeTemplateName:null==(a=e.adCreativeMetaData)?void 0:a.adCreativeTemplateName,deviceType:e.deviceType,creativeId:e.adCreativeMetaData.adCreativeId,...t}},e5=e=>{if(!e.htmlContentEncoded||0===e.htmlContentEncoded.trim().length)throw Error("No html content found on a server side fetch");let t=e.htmlContentEncodedLength?e.htmlContentEncoded:q(e.htmlContentEncoded);return e9(t,e.htmlContentEncodedLength),t},e9=(e,t)=>{t&&e.length!==t&&console.debug(`Mismatched expected htmlContentEncoded size. Expected ${t} but got ${e.length}`)},e4={win:{t:0,b:0,l:0,r:0,w:0,h:0},self:{t:0,l:0,r:0,b:0,xiv:0,yiv:0,iv:0,z:0,w:0,h:0},exp:{t:0,l:0,r:0,b:0,xs:0,yx:0}},e7=((e=-1)=>{let t=e;return{set(e){t=e},get:()=>t}})(),e8=((e=e4)=>({set(t){e.self={...e.self,...t.self}},get:()=>e}))(),e6=()=>({ext:{inViewPercentage:()=>e7.get(),geom:()=>e8.get()}});class te{tryEncapsulateInWrapper(e){if(this.o.creativeWrapperDivEncoded){this.c.countMetric("creativeWrapperDivEncoded",1,!0);let t=H(this.o.creativeWrapperDivEncoded),i=t.lastIndexOf("</div>");return[t.slice(0,i),e,t.slice(i)].join("")}return e}constructor(e,t,i,a,n,s){this.o=e,this.mp=t,this.cms=i,this.cmr=a,this.c=n,this.eventsChannel=s,this.renderCompleteTime=null,this.state={hasFiredCODPixel:!1},this.clickTrackingParam="",this.logInterventionReport=e=>{e1({metricName:"reporting-observer:heavy-ad-intervention",adDetails:this.o}),this.c.logFatal("heavy-ad-intervention",e)},this.initSFClient=async({timeout:e=eB}={})=>{this.ensureGlobals(),d(),c(),document.write=this.documentWriteDelegate,this.c.sendLatencyMetric(r),this.eventsChannel.onSafeFrameReady(this.o),O().isT1()||(this.clickTrackingParam=await eJ(this.mp,e)),this.mp.onmessage=this.cmr.receiveMessage,this.c.countMetric("adload:iframeinitialized",1),this.c.logCsaEvent("adload_iframeinitialized"),await this.writeCreativeToDocument()},this.writeCreativeToDocument=async()=>{tt(this,this.o);try{this.o.isNoInventory=!1;let e=eU(this.clickTrackingParam,e5(this.o));e=this.tryEncapsulateInWrapper(e),ez(this.cms,this.c.cr,this.o,this.eventsChannel,this.state),await this.documentWriteDelegate(e),this.eventsChannel.onPostCreativeWrite(this.o),await eF(this.o,this.cms,this.c.cr,this.c,this.eventsChannel),this.eventsChannel.onCreativeLoad(this.o),O().isT1()&&document.body.addEventListener("click",()=>{this.eventsChannel.onClick(this.o)},{once:!0})}catch(e){this.c.logError("Failed to get creative content",e),this.c.collapseSlotInternal("CLIENTSETUP"),this.eventsChannel.onError(this.o)}},this.ensureGlobals=()=>{var e;window.onerror=this.handleErrors,window.$sf=null!=(e=window.$sf)?e:e6(),window.$sfViewableInfo=N(),window.aaxInstrPixelUrl=this.o.aaxInstrPixelUrl},this.documentWriteDelegate=async e=>await eE(e,this,this.c,this.o),this.handleErrors=(e,t,i,a,n)=>{let r=n||Error(e.toString());return this.c.logError(`Window.onerror triggered inside of the iframe. Src: ${t}:${i}:${a}`,r),this.renderCompleteTime||this.c.collapseSlotInternal("CLIENTERROR"),this.eventsChannel.onError(this.o),!0};let o=document.open.bind(document);document.open=(...e)=>{let t=o(...e);return this.ensureGlobals(),t},this.nativeWrite=document.write.bind(document),window.onerror=this.handleErrors,eG(this.o,{onReport:this.logInterventionReport})}}const tt=(e,t)=>{t.creativeSupportsTTIMeasurement||window.addEventListener("load",()=>h(e.c),{once:!0}),window.addEventListener("load",()=>e.c.fireViewableLatencyMetrics(),{once:!0})},ti=()=>{window.dispatchEvent(new Event("load"))};class ta{constructor(e,t,i){this.cms=e,this.o=t,this.mL=i,this.fireImpression=async e=>{this.sendLatencyMetric(l),await this.cr.fireCodImpressionPixel()},this.changeSize=(e,t)=>{this.cms.sendMessage("changeSize",{width:e,height:t})},this.logCsaEvent=e=>{this.cms.sendMessage("logCsaEvent",{metricName:e})},this.registerCustomMessageListener=(e,t)=>{this.mL[e]=t,this.countMetric("sf:commonmain:registerCustomMessageListener",1,!0)},this.sendLatencyMetric=e=>{this.cms.sendMessage("sendLatencyMetric",{latencyMetricType:e,timestamp:new Date})},this.countMetric=(e,t=1,i=!1)=>{this.cms.sendMessage("countMetric",{metricMsg:e,value:t,isGlobal:i})},this.fireViewableLatencyMetrics=()=>{this.cms.sendMessage("fireViewableLatencyMetrics",{adLoadedTimestamp:Date.now()})},this.feedbackLabelRendered=()=>{this.cms.sendMessage("feedbackLabelRendered")},this.feedbackOpenModal=()=>{this.cms.sendMessage("feedbackOpenModal")},this.updateViewability=e=>{var t,i,a,n,r,s,o;let l=N();if(A(e),!this.o.aaxInstrPixelUrl||!l.payload||!l.viewabilityStandards)return;let d=(null==(a=window)||null==(i=a.$sf)||null==(t=i.ext)?void 0:t.geom)&&(null==(r=window)||null==(n=r.$sf)?void 0:n.ext.geom()),c=(null==d||null==(s=d.self)?void 0:s.iv)?null==d||null==(o=d.self)?void 0:o.iv:null;if(J(this.o.mediaType)){let e=_();this.cr.fireViewablePixelsForVideo(c,l.payload(),l.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}},this.updatePlayingTimeForVideo=e=>{if(V().isT1())this.cms.sendMessage("sendSfVideoContinuousPlaytimeSeconds",{sfVideoContinuousPlaytimeSeconds:e});else{var t,i,a,n;let r=N();L(e);let s=(null==(a=window)||null==(i=a.$sf)||null==(t=i.ext)?void 0:t.geom)&&window.$sf.ext.geom(),o=null==s||null==(n=s.self)?void 0:n.iv;if(o&&r.payload&&r.viewabilityStandards){let e=_();this.cr.fireViewablePixelsForVideo(o,r.payload(),r.viewabilityStandards(),!!this.o.isNoInventory,e.playingTime?e.playingTime():null)}}},this.requestVideoAutoplay=()=>{this.cms.sendMessage("requestVideoAutoplay")},this.releaseVideoAutoplay=()=>{this.cms.sendMessage("releaseVideoAutoplay")},this.haveVideoAutoplayPermission=()=>{this.cms.sendMessage("haveVideoAutoplayPermission")},this.isOnAmazon=()=>!0,this.logError=(e,t,i)=>{this.cms.sendMessage("logError",{message:e,error:t,level:i})},this.logFatal=(e,t,i)=>{this.cms.sendMessage("logFatal",{message:e,error:t,level:i})},this.collapseSlotInternal=e=>{this.logAPIInvocation("collapseSlot"),this.cms.sendMessage("collapseSlot",e)},this.collapseSlot=()=>{this.collapseSlotInternal("CREATIVE")},this.resizeCreativeWrapper=e=>{let t=window.document.getElementById(`ape_${this.o.scope}_creativeWrapper`);null!==t&&(t.style.height=e.height,t.style.width=e.width)},this.triggerEventInIframe=e=>{window.dispatchEvent(new Event("outerpage"+e.eventType))},this.logAPIInvocation=(e,...t)=>{this.cms.sendMessage("logAPIInvocation",{apiName:e,apiParams:t}),this.cms.sendMessage("logCsaEvent",{metricName:"messenger_"+e})},this.setupComputedAdDetails=e=>{window.aPageStart=e.aPageStart,window.adStartTime=e.adStartTime},this.signalAdLoadedAndInteractive=()=>{h(this)},this.sendEventAddedCreative=()=>{this.cms.sendMessage("sendEventAddedCreative")},this.populateGeom=e=>e8.set(e.geom),this.populateSafeFrameExt=e=>{e7.set(e.inViewPercentage),e8.set(e.geom)},this.cr=new eo(this,t)}}class tn{constructor(e,t){this.o=e,this.messagePort=t,this.sendMessage=(e,t)=>{let i={command:e,adDetails:this.o,payload:t||{}};try{this.messagePort.postMessage(i)}catch(e){m("Post Message error",e)}}}}class tr{constructor(e,t,i){this.c=e,this.o=t,this.mL=i,this.pendingMessages=new Map,this.waitForMessageProcessed=async e=>new Promise(t=>this.pendingMessages.set(e,t)),this.receiveMessage=e=>{try{let t=e.data,i=t.command?t.command.split("."):[],a=this.c[i[0]];for(let e=1;e<i.length;e++)if(a)a=a[i[e]];else break;if("customMessage"===t.command){let e=t.data.key,i=t.data.data;if("function"==typeof this.mL[e])try{this.mL[e](i)}catch(e){this.c.logError("Custom Message Listener Error",e)}}else a&&(a(t.data),ts(t.command,this.pendingMessages))}catch(t){this.c.logError("Error with "+e.data.command,t);return}}}}const ts=(e,t)=>{let i=null==t?void 0:t.get(e);null==i||i(),null==t||t.delete(e)};class to extends ta{constructor(e,t,i){super(e,t,i),this.isSupported=()=>!0,this.getARID=()=>this.o.arid,this.sendAdInfo=e=>{e&&this.o.adCreativeMetaData&&(this.o.adCreativeMetaData=e)},this.getPlacementInfo=()=>(this.logAPIInvocation("getPlacementInfo"),{slot:this.o.placementName,slotName:this.o.slotName,pageType:this.o.pageType})}}const tl=e=>({onSafeFrameReady:t=>td(e,"onSafeFrameReady",t),onPreCreativeWrite:t=>td(e,"onPreCreativeWrite",t),onPostCreativeWrite:t=>td(e,"onPostCreativeWrite",t),onCreativeBeginToRender:t=>td(e,"onCreativeBeginToRender",t),onCreativeLoad:t=>td(e,"onCreativeLoad",t),onError:t=>td(e,"onError",t),onClick:t=>td(e,"onClick",t)}),td=(e,t,i)=>{try{e.postMessage({command:t,adDetails:i,payload:{}})}catch(e){m("Post Message error",e)}},tc=(e,t)=>{let i=new tn(e,t),a={},n=new to(i,e,a),r=new tr(n,e,a),s=tl(t);return new te(e,t,i,r,n,s)},tm=async(t,i,a)=>{try{var n,r,s;e(),window.renderingWeblabs=JSON.parse(null!=(s=a.weblabTreatments)?s:""),null==(r=performance)||null==(n=r.mark)||n.call(r,"SafeFrame: SF received ad details");let o=t(i,a);try{o.initSFClient()}catch(e){o.c.logError("Could not init SafeFrame Client",e)}}catch(e){m("Could not init ",e)}},th=e=>{var t,i;null==(i=performance)||null==(t=i.mark)||t.call(i,`SafeFrame: Start Send Ready ${e}`);try{window.parent.dispatchEvent(new MessageEvent("message",{source:window,origin:window.location.origin,ports:[e],data:u}))}catch(t){window.parent.postMessage(u,"*",[e])}},tu=()=>""!==window.name?JSON.parse(window.name):null;null==(w=performance)||null==(v=w.mark)||v.call(w,"SafeFrame: Enter sf.ts"),window.SFClient||(e=>{if("null"!==window.origin&&!I())return y(`Referrer not allowed: ${document.referrer}`);let t=tu();if(t){let i=new MessageChannel;tm(e,i.port1,t),th(i.port2)}else p("Ad Details not found in name!")})((e,t)=>{let i=tc(t,e);return window.SFClient=i.c,i});
//# sourceMappingURL=sf-1.50.40d40c69.js.map
